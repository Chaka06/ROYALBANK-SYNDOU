{% extends 'base.html' %}
{% block content %}
<div class="mb-4">
  <a href="/dashboard/" class="btn btn-outline-primary btn-sm mb-3">
    <i class="bi bi-arrow-left me-1"></i>Retour au tableau de bord
  </a>
  <h4 class="section-title">Carte Visa</h4>
</div>

<div class="row g-4">
  <div class="col-12 col-md-6">
    <div class="card" style="background: linear-gradient(135deg, #0047bb 0%, #003a98 100%); color: white; border: none; min-height: 180px; position: relative; overflow: hidden;">
      <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
      <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%;"></div>
      <div class="card-body d-flex flex-column justify-content-between" style="position: relative; z-index: 1;">
        <div>
          <div class="d-flex justify-content-between align-items-start mb-4">
            <div>
              <div class="small opacity-75">Carte bancaire</div>
              <div class="fw-bold fs-5">{{ card.card_type }}</div>
            </div>
            <div style="font-size: 0; opacity: 0.95;">
              {% if card.card_type == 'VISA' %}
              <!-- Inline VISA logo SVG -->
              <svg width="64" height="20" viewBox="0 0 90 28" xmlns="http://www.w3.org/2000/svg" aria-label="VISA">
                <rect width="90" height="28" fill="none" />
                <path fill="#fff" d="M38.2 22.9l3.1-17.7h5l-3.1 17.7h-5zm23.7-17.4c-1-.4-2.6-.8-4.6-.8-5.1 0-8.7 2.6-8.8 6.2-.1 2.7 2.6 4.2 4.6 5.1 2 .9 2.7 1.5 2.7 2.4-.1 1.3-1.6 1.9-3.2 1.9-2.1 0-3.3-.3-5.1-1.1l-.7-.3-.8 4.4c1.3.6 3.6 1.1 6 1.2 5.7 0 9.4-2.6 9.5-6.5.1-2.2-1.4-3.9-4.4-5.3-1.8-.9-3-1.5-3-2.4 0-.8 1-1.6 3-1.6 1.7 0 3 .3 4 .7l.5.2.8-4.2zm10.9-.3h-3.9c-1.2 0-2.1.3-2.7 1.6l-7.4 16.1h5.2l1-2.7h6.4l.5 2.7h4.6l-3.7-17.7zm-5.9 11.4l2-5.4 1.1 5.4h-3.1zm-40.4-11.4l-5 12.1-.6-3.1c-1.2-3.7-4.9-7.7-9-9.7l4.6 17.6h5.4l8-17h-3.4z"/>
              </svg>
              {% else %}
                <i class="bi bi-credit-card-2-front" style="font-size: 2rem;"></i>
              {% endif %}
            </div>
          </div>
          <div class="mb-4">
            <div class="small opacity-75 mb-2">Numéro de carte</div>
            <div class="fs-3 fw-bold" style="letter-spacing: 0.15em; font-family: 'Courier New', monospace;">{{ card.masked_number }}</div>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-end">
          <div>
            <div class="small opacity-75 mb-1">Titulaire</div>
            <div class="fw-bold fs-6">{{ card.cardholder_name }}</div>
          </div>
          <div>
            <div class="small opacity-75 mb-1">Expire</div>
            <div class="fw-bold fs-6">{{ card.formatted_expiry }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card">
      <div class="card-body">
        <h6 class="mb-4">Informations de la carte</h6>
        <div class="mb-3">
          <div class="text-muted small">Type de carte</div>
          <div class="fw-bold">{{ card.get_card_type_display }}</div>
        </div>
        <div class="mb-3">
          <div class="text-muted small">Numéro complet</div>
          <div class="input-group">
            <input type="text" class="form-control" id="card-number" value="{{ card.card_number }}" readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="copyCardNumber()">
              <i class="bi bi-clipboard"></i>
            </button>
          </div>
        </div>
        <div class="mb-3">
          <div class="text-muted small">CVV</div>
          <div class="input-group">
            <input type="text" class="form-control" id="cvv" value="{{ card.cvv }}" readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="copyCVV()">
              <i class="bi bi-clipboard"></i>
            </button>
          </div>
        </div>
        <div class="mb-3">
          <div class="text-muted small">Date d'expiration</div>
          <div class="fw-bold">{{ card.formatted_expiry }}</div>
        </div>
        <div>
          <div class="text-muted small">Statut</div>
          <div>
            {% if card.is_active %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-danger">Désactivée</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyCardNumber() {
  const input = document.getElementById('card-number');
  input.select();
  document.execCommand('copy');
  alert('Numéro de carte copié !');
}

function copyCVV() {
  const input = document.getElementById('cvv');
  input.select();
  document.execCommand('copy');
  alert('CVV copié !');
}
</script>
{% endblock %}

