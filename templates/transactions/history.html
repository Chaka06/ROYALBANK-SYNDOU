{% extends 'base.html' %}
{% block content %}
  <h4 class="section-title mb-3">Historique des transactions</h4>
  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>Date</th>
              <th>Bénéficiaire</th>
              <th class="d-none d-md-table-cell">IBAN</th>
              <th>Montant</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody>
            {% for t in transactions %}
            <tr style="cursor: pointer;" onclick="window.location.href='/transactions/{{ t.id }}/'">
              <td>
                <span class="d-none d-md-inline">{{ t.created_at|date:'d/m/Y H:i' }}</span>
                <span class="d-md-none">{{ t.created_at|date:'d/m' }}<br>{{ t.created_at|date:'H:i' }}</span>
              </td>
              <td>
                <strong class="d-none d-md-inline">{{ t.beneficiary_name|default:"—" }}</strong>
                <strong class="d-md-none">{{ t.beneficiary_name|default:"—"|truncatewords:2 }}</strong>
                <code class="small d-md-none d-block mt-1">{{ t.beneficiary_iban|default:"—"|slice:":20" }}...</code>
              </td>
              <td class="d-none d-md-table-cell"><code class="small">{{ t.beneficiary_iban|default:"—" }}</code></td>
              <td class="fw-bold">{{ t.amount_display }}</td>
              <td>
                {% if t.status == 'REJECTED' %}
                  <span class="badge bg-danger">
                    <i class="bi bi-x-circle me-1"></i><span class="d-none d-sm-inline">REJETÉ</span><span class="d-sm-none">R</span>
                  </span>
                {% elif t.status == 'COMPLETED' %}
                  <span class="badge bg-success">
                    <i class="bi bi-check-circle me-1"></i><span class="d-none d-sm-inline">FAIT</span><span class="d-sm-none">F</span>
                  </span>
                {% else %}
                  <span class="badge bg-secondary">
                    <i class="bi bi-clock me-1"></i><span class="d-none d-sm-inline">EN ATTENTE</span><span class="d-sm-none">E</span>
                  </span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted py-4 d-md-none">
                <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                <div class="mt-2">Aucune transaction</div>
              </td>
              <td colspan="5" class="text-center text-muted py-4 d-none d-md-table-cell">
                <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                <div class="mt-2">Aucune transaction</div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  {% if transactions.has_other_pages %}
  <nav aria-label="Pagination des transactions">
    <ul class="pagination justify-content-center mt-4">
      {% if transactions.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1">
            <i class="bi bi-chevron-double-left"></i>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ transactions.previous_page_number }}">
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link"><i class="bi bi-chevron-double-left"></i></span>
        </li>
        <li class="page-item disabled">
          <span class="page-link"><i class="bi bi-chevron-left"></i></span>
        </li>
      {% endif %}
      
      {% for num in transactions.paginator.page_range %}
        {% if transactions.number == num %}
          <li class="page-item active">
            <span class="page-link">{{ num }}</span>
          </li>
        {% elif num > transactions.number|add:'-3' and num < transactions.number|add:'3' %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}
      
      {% if transactions.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ transactions.next_page_number }}">
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ transactions.paginator.num_pages }}">
            <i class="bi bi-chevron-double-right"></i>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link"><i class="bi bi-chevron-right"></i></span>
        </li>
        <li class="page-item disabled">
          <span class="page-link"><i class="bi bi-chevron-double-right"></i></span>
        </li>
      {% endif %}
    </ul>
    <div class="text-center text-muted small mt-2">
      Page {{ transactions.number }} sur {{ transactions.paginator.num_pages }}
    </div>
  </nav>
  {% endif %}
{% endblock %}
